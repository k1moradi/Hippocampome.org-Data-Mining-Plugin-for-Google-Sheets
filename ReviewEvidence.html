<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <?!= include('shortcuts'); ?>
    <?!= include('script_CSS'); ?>
    <style>
      .container, .backdrop, textarea {
        width: 765px;
        height:678px;
      }
      
      .highlights, textarea {
        padding: 0px;
        font: 16px/24px 'Open Sans', sans-serif;
        letter-spacing: 1px;
        line-height: 1.5em;
      }
      p > br {
        content: '';
        white-space: pre;
      }
      <?for (var i = 1; i <= 1000; i++) {?>
        p > br:nth-child(<?=i?>):after {content: '\A      ';}
      <?}?>
      
    .Button:active, .active {
       background-color:rgba(153, 230, 255,.9);
       color: white;
     }
    </style>
  </head>
  <body>
    <iframe style="float:left; width:662px; height:729px;" src="<?=url?>" scrolling="yes" marginwidth="0" marginheight="0" frameborder="0" vspace="0" hspace="0"></iframe>
    <div id='main' style='float:right; width:786px; height:729px; overflow:auto;'>
    
      <?//-----Functions----------------------------------------------------------------------------------------------------------------
        function showReferences(linkedRefIDs,allReferences,references,groupName,bgColor,fontColor,fontSize) {
          if (linkedRefIDs.length !== 0) { ?>
      <details open>
        <summary style='background-color:<?=bgColor?>;color:<?=fontColor?>; margin:0; font-size:<?=fontSize?>;'>
          <?= groupName ?>
        </summary>
        <? linkedRefIDs.sort(function(a,b){return a-b}).forEach(function(refID){
            var theReference = references[refID]; ?>
        <details id='Reference' open>
          <summary style='background-color:black; color:white; margin:0; font-size:120%;'>
            <b>ID:</b><a style='color:pink' href='javascript:return false;' onclick="copyStringToClipboard(this.text)"><?= refID ?></a>, 
            <? if (typeof theReference !== "undefined") {?>
            <i style='color:yellow'><?= theReference.Location?></i>, 
            <?=theReference.UID}?>
          </summary>
          <?if (typeof theReference === "undefined") {?>
          <p style='color:red;'>
            ‚ùå ID is not associated with any reference in our database. Delete it!
          </p>
          </details>
          <?} else {
              var UID = theReference.UID;
              if (UID) {?>
          <details>
            <summary style='background-color:#3F51B5; color:white; margin:0;'>
              <b>Cell Types:</b>
            </summary>
            <?  if (typeof UID === 'string') {
                  if (UID.replace(/[\s\d,;]+/g,'') !== '') {// is not a UID array in string format
                    UID.split(/\s*[,;]+\s*/g)
                       .filter(Null)
                       .forEach(function(eachUID){ ?>
            <p><?=       eachUID ?>
            </p><?     });
                  } else {
                    UID.split(/\s*[,;]+\s*/g)
                        .filter(Null)
                        .forEach(function(eachUID){?>
            <p><b><?=      eachUID ?>: </b><?=(cellTypes[eachUID]) ? cellTypes[eachUID].Name : '‚ùåundefined cell type UID';?>
            </p>
            <?          }); 
                  };
                } else { ?>
            <p><b><?= UID ?>: </b><?= (cellTypes[UID]) ? cellTypes[UID].Name : UID+':‚ùåundefined cell type UID'; ?>
            </p>
            <?  } ?>
          </details>
          <?  }?>
          <p>
            <?!= refHighlights(theReference.Quote) ?>
          </p>
          <?if (theReference.Figure) {
              String(theReference.Figure)
              .split(/\s*[;,]+\s*/g)
              .filter(Null)
              .forEach(function(fileName){
                var fileIDs = getFileIDs(fileName);
                if (fileIDs.length !== 0) {
                  fileIDs.forEach(function(fileID){
                    if (fileName.replace(/\.[^.]*$/g,'') === refID || (theReference.HcoRefID && imagesShown.indexOf(fileName) === -1)) {
                      imagesShown.push(fileName);?>
          <details open>
          <?        } else {?>
          <details>
          <?        }?>
            <summary style='background-color:#3F51B5; color:white; margin:0;'>
              <b>File: </b><a style='color:white' href='javascript:return false;' onclick="copyStringToClipboard(this.text)"><?=fileName?></a>
              <?    var possibleRefID = fileName.replace(/\.[^.]*$/g,'');
                    if (possibleRefID.replace(/\d*/g,'') === '') {
                      var theFigRef = allReferences[possibleRefID]; 
                      if (theFigRef) {?>
              <?=       theFigRef.Location?>
              <?      }};?>
            </summary>
            <img src='https://drive.google.com/uc?export=view&id=<?=fileID?>' style='width:100%;'>
            <?      if (theFigRef && (fileName.replace(/\.[^.]*$/g,'') !== refID)) {?>
            <p><?!=   (theFigRef.Location !== theReference.Location) ? refHighlights(theFigRef.Quote) : ''; ?>
              <?      theFigRef=null};?>
            </p>
          </details>
          <?      })} else {?>
          <p style='background-color:#3F51B5; color:white; margin:0;'>‚ùå<b>File:</b> <?=String(fileName)?> does not exist</p>
          <?  }})};?>
        </details>
        <?}})?>
      </details>
      <? }};
         
        function showAllReferences(presynapticRefIDs,postsynapticRefIDs,allReferences,groupReferences,groupName,bgColor,fontColor) {?>
      <details open>
        <summary style='background-color:<?=bgColor?>;color:<?=fontColor?>; margin:0; font-size:200%;'>
          <?=groupName?>
        </summary>
        <? var refIDsUniqueToPre  = presynapticRefIDs.filter(function(refID){return (postsynapticRefIDs.indexOf(refID) === -1)}); 
           var refIDsUniqueToPost = postsynapticRefIDs.filter(function(refID){return (presynapticRefIDs.indexOf(refID) === -1)}); 
           var refIDsCommonToBoth = presynapticRefIDs.filter(function(refID){return (refIDsUniqueToPre.indexOf(refID) === -1)});
           var linkedRefIds = mergeArrays(presynapticRefIDs,postsynapticRefIDs);
           var unlinkedRefIds = Object.keys(groupReferences).filter(function(refID){return (linkedRefIds.indexOf(refID) === -1)});
           showReferences(refIDsCommonToBoth,allReferences  ,allReferences,'‚úÖBoth Sides'       ,'#3F51B5','white','150%'); 
           showReferences(refIDsUniqueToPre ,allReferences  ,allReferences,'‚úÖPresynaptic Only' ,'#3F51B5','white','150%'); 
           showReferences(refIDsUniqueToPost,allReferences  ,allReferences,'‚úÖPostsynaptic Only','#3F51B5','white','150%'); 
           showReferences(unlinkedRefIds    ,allReferences,groupReferences,'‚ùåUnlinked'         ,'#3F51B5','white','150%'); ?>
      </details>
      <?}; 
      
//===========================================Top======================================================================================?>
      
      <div style='width:100%; height:25px; position:fixed; background-color:black;'>
         <input type='text' placeholder='Case-sensitive Search and Highlight in Green' style='width:604px;' onchange="caseSensitiveSearch(this.value,'main');">
         <input type='button' value='üìå' onclick="javascript:$('#evidence').toggle(function(){$('#evidence').css('overflow','hidden')},function(){$('#evidence').css('overflow','auto')});$(this).toggleClass('active')" >
         <input type='button' value='References:Collapse' onclick='toggleReferences(this)'>
      </div>
      <div id='evidence' style='margin-top:25px'>
      <a href='https://www-ncbi-nlm-nih-gov.mutex.gmu.edu/pubmed/?term=<?=evidence.PMID?>' target='_blank'><?=covariates.Reference?></a><br>
      
      <?var unlinkedRefIds = Object.keys(myRefs).filter(function(refID){return (evidence.allRefIDs.indexOf(refID) === -1)});
        showAllReferences(evidence.CovariatesIDs      ,evidence.CovariatesIDs       ,allRefs,covariatesRef ,'Covariates:'                  ,'#99FFFF','black');
        showAllReferences(evidence.MorphologyIDsPre   ,evidence.MorphologyIDsPost   ,allRefs,morphology    ,'Anatomy & Morphology:'        ,'#F9DF16','black');
        showAllReferences(evidence.MarkersIDsPre      ,evidence.MarkersIDsPost      ,allRefs,markers       ,'Markers:'                     ,'#DD0083','yellow');
        showAllReferences(evidence.CellePhysIDsPre    ,evidence.CellePhysIDsPost    ,allRefs,cellEphys     ,'Electrophysiology:'           ,'#0090CC','yellow');
        showAllReferences(evidence.FiringPatternIDsPre,evidence.FiringPatternIDsPost,allRefs,firingPatterns,'Firing Patterns:'             ,'#F47C01','yellow');
        showAllReferences(evidence.ConnectivityIDsPre ,evidence.ConnectivityIDsPost ,allRefs,connectivity  ,'Connectivity:'                ,'#01AA59','yellow');
        showAllReferences(evidence.DataIDs            ,evidence.DataIDs             ,allRefs,dataRefs      ,'Synaptic Data:'               ,'#E91E63','white');
        showReferences   (unlinkedRefIds                                            ,allRefs,myRefs      ,'‚ùåMy Mixed Unlinked References:','#00F0F0','black','200%')
        
      //-----Text Cleaner Tool--------------------------------------------------------------------------------------------------------?>
      </div>
      <h3 style='background-color:rgb(233, 30, 99);color:white; margin:0;'>PDF Text Cleaner Tool</h3>
      <form id='CleanText'>
        <?!= include("TextCleanerScripts") ?>
        <div class='container'>
          <div class='backdrop'>
            <div class='highlights'></div>
          </div>
          <TEXTAREA NAME='inputText' onSelect='formatText(this.form)'></TEXTAREA>
        </div>
        <?!= include('jquery.min'); ?>
        <?!= include('highlightableTextArea'); ?>
      </form> 
    </div>
  </body>
</html>